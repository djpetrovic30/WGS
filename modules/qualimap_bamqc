nextflow.enable.dsl=2

process qualimap_bamqc {
  tag "${sample_id}"
  publishDir 'qualimap_bamqc_results'
  input:
  tuple val(sample_id), path(bamfiles)

  output:
  tuple val(sample_id), path("${sample_id}_bamqc.bam"), emit: bamqc_bam

  script:
  """
  qualimap bamqc -bam ${bamfiles}
  """
}

workflow.onComplete {
    println "Pipeline completed at: $workflow.complete"
    println "Execution status: ${ workflow.success ? 'OK' : 'failed' }"
}

workflow.onError {
    println "Pipeline execution stopped with the following message: ${workflow.errorMessage}"
}

workflow qualimap_bamqc_wf {
  take:
    bamfiles
  main:
    qualimap_bamqc(bamfiles)
  emit:
    bamqc_bam = qualimap_bamqc.out.bamqc_bam
  }

  workflow {
    ch_bamfiles = Channel.fromPath(params.bamfiles)
    qualimap_bamqc(ch_bamfiles)
  }
